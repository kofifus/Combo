'use strict';function Combo(elem,lru=5){let self=this;let changeFunc,keydownFunc,inputFunc,blurFunc;let sel,inp;function getInputElement(){return inp}
function getSelectElement(){return sel}
function getWrapper(){return elem}
function addOpt(optText){for(let i=0;i<sel.options.length;i++)if(sel.options[i].text===optText)return;let option=document.createElement('option');option.text=optText;sel.add(option,0);if(sel.children.length>lru)sel.removeChild(sel.children[sel.children.length-1])}
function options(opts=undefined){if(opts===undefined)return sel.options;if(opts.constructor!==Array)opts=[opts];for(let i=sel.options.length-1;i>=0;i--)sel.remove(i);for(let i=opts.length-1;i>=0;i--)addOpt(opts[i]);sel.selectedIndex=-1}
function focus(){inp.focus()}
function select(b=!0){if(b)inp.select();else b.setSelectionRange(0,0)}
function hookEvents(){sel.onchange=e=>{e.stopPropagation();if(inp.value!==sel.value){inp.value=sel.value;if(changeFunc)setTimeout(()=>changeFunc.call(self,e,self),20)}};inp.onkeydown=e=>{e.stopPropagation();let key=e.key;let res;if(keydownFunc)res=keydownFunc.call(self,e,self);if(res===!1||e.defaultPrevented)return;if(key==='Enter'){if(inp.value)addOpt(inp.value);if(changeFunc)setTimeout(()=>changeFunc.call(self,e,self),20);e.preventDefault()}else if(key==='ArrowUp'){if(sel.selectedIndex>0){sel.selectedIndex--;inp.value=sel.value}}else if(key==='ArrowDown'){if(sel.selectedIndex<sel.options.length-1){sel.selectedIndex++;inp.value=sel.value}}
return!0};inp.oninput=e=>{if(inputFunc)inputFunc.call(self,e,self)};inp.onclick=e=>{e.stopPropagation()};sel.onclick=e=>{e.stopPropagation();if(sel.dataset.open==='true')setTimeout(null,()=>{inp.focus()},0);else sel.selectedIndex=-1;sel.dataset.open=(sel.dataset.open==='false'?'true':'false')};inp.onblur=sel.onblur=e=>{if(blurFunc)blurFunc.call(self,e,self)}}
function ctor(){let innerHTML=`
			<select style="border: none; outline: none;padding: 0; margin: 0; "></select>
			<input style="border: none; outline: none; padding: 0; margin: 0; position:relative; margin-left: 1px;"/>`;let parent=elem.parentElement,indexInParent=[].slice.call(parent.children).indexOf(elem);elem.innerHTML=innerHTML;elem=parent.children[indexInParent];sel=elem.children[0],inp=elem.children[1];if(!elem.border)elem.style.border='1px solid';let elemStyle=window.getComputedStyle(elem);let elemWidth=Number(elemStyle.width.replace(/[^\d\.\-]/g,''));let elemHeight=Number(elemStyle.height.replace(/[^\d\.\-]/g,''));sel.style.width=(elemWidth-2)+'px';sel.style.height=elemHeight+'px';sel.style.fontSize=elemStyle.fontSize;sel.selectedIndex=-1;sel.dataset.open='false';inp.style.top='-'+elemHeight+'px';inp.style.width=(elemWidth-16)+'px';inp.style.height=elemHeight+'px';inp.style.fontSize=elemStyle.fontSize;inp.focus();hookEvents()}
return{focus,select,options,getInputElement,getSelectElement,getWrapper,get value(){return inp.value},set value(val){inp.value=val},set onchange(f){changeFunc=f},set oninput(f){inputFunc=f},set onkeydown(f){keydownFunc=f},set onblur(f){blurFunc=f},}}
